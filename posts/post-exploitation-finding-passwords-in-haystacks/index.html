<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="norsec0de">
<meta name="description" content="Often while conducting an internal pentest you may gain access to a user machine through some vulnerability or more commonly via social engineering. Let’s say that you pop a shell, unprivileged, and incognito only finds unprivileged domain tokens. You could move onto another target or you can try some post exploitation reconnaissance. A commonly overlooked source of sensitive information is documents that are stored on the company servers as well as staff who think they know enough to start sharing folders with their peers and end up sharing the root of ‘C’." />
<meta name="keywords" content="infosec, norsey, norsec0de, hacker for hire, Kali, passwords, pentesting, post exploitation, recoll, ShareEnum, shares, windows" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="https://www.pwnd.red/posts/post-exploitation-finding-passwords-in-haystacks/" />


    <title>
        
            post exploitation: finding passwords in haystacks :: norsey&#39;s hideout 
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="https://www.pwnd.red/main.393856bf2c430bb6c01d7af07c6fe966e7cce8073435cfbbc46e590bab7405ef.css">






<meta itemprop="name" content="post exploitation: finding passwords in haystacks">
<meta itemprop="description" content="Often while conducting an internal pentest you may gain access to a user machine through some vulnerability or more commonly via social engineering. Let’s say that you pop a shell, unprivileged, and incognito only finds unprivileged domain tokens. You could move onto another target or you can try some post exploitation reconnaissance. A commonly overlooked source of sensitive information is documents that are stored on the company servers as well as staff who think they know enough to start sharing folders with their peers and end up sharing the root of ‘C’.">
<meta itemprop="datePublished" content="2013-12-19T02:55:06+00:00" />
<meta itemprop="dateModified" content="2013-12-19T02:55:06+00:00" />
<meta itemprop="wordCount" content="804">
<meta itemprop="image" content="https://www.pwnd.red/"/>



<meta itemprop="keywords" content="hacker for hire,Kali,passwords,pentesting,post exploitation,recoll,ShareEnum,shares,windows," />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://www.pwnd.red/"/>

<meta name="twitter:title" content="post exploitation: finding passwords in haystacks"/>
<meta name="twitter:description" content="Often while conducting an internal pentest you may gain access to a user machine through some vulnerability or more commonly via social engineering. Let’s say that you pop a shell, unprivileged, and incognito only finds unprivileged domain tokens. You could move onto another target or you can try some post exploitation reconnaissance. A commonly overlooked source of sensitive information is documents that are stored on the company servers as well as staff who think they know enough to start sharing folders with their peers and end up sharing the root of ‘C’."/>





    <meta property="article:section" content="post exploitation" />

    <meta property="article:section" content="tools" />

    <meta property="article:section" content="tutorial" />



    <meta property="article:published_time" content="2013-12-19 02:55:06 &#43;0000 &#43;0000" />








    </head>

    <body class="">
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="https://www.pwnd.red/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text">norsey&#39;s hideout</span>
            <span class="logo__cursor" style=
                  "
                   
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="https://www.pwnd.red/posts">intel</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            

            <span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>
</span>
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            
            </p>
        </div>

        <article>
            <h2 class="post-title"><a href="https://www.pwnd.red/posts/post-exploitation-finding-passwords-in-haystacks/">post exploitation: finding passwords in haystacks</a></h2>

            

            

            <div class="post-content">
                <p>Often while conducting an internal pentest you may gain access to a user machine through some vulnerability or more commonly via social engineering. Let’s say that you pop a shell, unprivileged, and incognito only finds unprivileged domain tokens. You could move onto another target or you can try some post exploitation reconnaissance. A commonly overlooked source of sensitive information is documents that are stored on the company servers as well as staff who think they know enough to start sharing folders with their peers and end up sharing the root of ‘C’. These can be a fantastic source of juicy info if you know how to index and then search through them effectively.</p>
<p>Firstly we need to see what shares your victim has access to. Nmap’s NSE will only get you so far but fortunately Microsoft has their own tool to do this for us, and best of all, it’s signed by Microsoft so using this is seldom an issue.</p>
<p>Grab <a href="http://technet.microsoft.com/en-us/sysinternals/bb897442.aspx">ShareEnum</a> from <a href="http://technet.microsoft.com/en-us/sysinternals">Sysinternals</a>. It’s a self-contained executable that doesn’t require any installation. Wait for the vic to take lunch or head home, connect to his desktop and run the tool. If you don’t have his password yet, use the <a href="http://www.rapid7.com/db/modules/post/windows/capture/lockout_keylogger">Metasploit Lockout Credential Keylogger</a>. If you’re lucky enough, ShareEnum will get you all the shares for the entire domain otherwise just use the local subnets to search for the data stores. Make a note of the mapped drives and take note of the UNC paths; this will come in handy later.</p>

    <img src="https://www.pwnd.red/images/post-exploitation-finding-passwords-in-haystacks/shareenum01.png"  class="left"  />


<p>Once you’ve exported the data into a text file, use your text editor to get the share names and begin creating a mount script to mount them. Ensure that you mount them all under the same subfolder, e.g. <code>/mnt</code> or <code>/media</code>, so we can configure the indexer to only index these mounts and not waste time indexing your own drive. Run the script to create all the mount points.</p>

    <img src="https://www.pwnd.red/images/post-exploitation-finding-passwords-in-haystacks/mkmounts01.png"  class="left"  />


<p>Once you’ve created a mount point for each of the shares, create a script to mount the shares and run it.</p>

    <img src="https://www.pwnd.red/images/post-exploitation-finding-passwords-in-haystacks/mountshares01.png"  class="left"  />


<p>Now that the shares are mounted, the indexing tool needs to be installed and configured. A decent indexing tool that I would recommend is called <a href="http://www.lesbonscomptes.com/recoll/">Recoll</a>. Recoll may already be installed in Kali. The benefit to using Recoll over some alternatives is that it can index the usual text and spreadsheet documents as well as inside ZIP file formats including the newer .DOCX, .XLSX and .PPTX. It also parses MIME, XML and PDF very well.</p>

    <img src="https://www.pwnd.red/images/post-exploitation-finding-passwords-in-haystacks/recoll.png"  class="left"  />


<p>Installing recall on Kali or Ubuntu is pretty simple.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">sudo apt-get install recoll
</code></pre></div><p>Once you have downloaded the tool, you will need to edit the config file which by default is stored at</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">~/.recoll/recoll.conf
</code></pre></div><p>I found these settings to be the best time/finding trade-off.</p>

    <img src="https://www.pwnd.red/images/post-exploitation-finding-passwords-in-haystacks/configfile01.png"  class="left"  />


<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-txt" data-lang="txt">topdirs = path where you mounted the shares
idxflushmb = database store size before flush
skippedNames = files &amp; extensions you don’t want indexed (filenames will still be shown, not contents)
indexedmimetypes = the file types that you want indexed
</code></pre></div><p>Once the config file is configured, pipe in the list of files you want indexed. Use a command such as</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">find /mnt –type f –print | recollindex –i
</code></pre></div><p>Once the files have been indexed, open up the Recoll GUI and start searching for keywords that will help get you some additional passwords. A list of keywords that worked well</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-txt" data-lang="txt">credit card
ctrl alt del
domain\
id
ident
key
log in
log on
login
logon
net use
net user
pass
passphrase
passwd
password
pin
phrase
pw
pword
secret
ssid
un
uname
user
username
wireless
</code></pre></div><p>Here are a couple of screenshots from just a few shares that were available on this local subnet.</p>

    <img src="https://www.pwnd.red/images/post-exploitation-finding-passwords-in-haystacks/findings_password01.png"  class="left"  />



    <img src="https://www.pwnd.red/images/post-exploitation-finding-passwords-in-haystacks/findings_netuser01.png"  class="left"  />



    <img src="https://www.pwnd.red/images/post-exploitation-finding-passwords-in-haystacks/findings_database01.png"  class="left"  />


<p>The keyword list is by no means comprehensive, however it should provide a solid foundation for a way of thinking about sensitive documents that are shared with everyone. As pentesters, we can use this information to increase our reach and impact on the client network. Knowing items such as the local administrator passwords and using them with <code>PSEXEC</code> can compromise the majority of machines on the network and the chances of now finding a domain administrator token on one of those boxes is going to increase.</p>
<p>Even the best training and policies are not going to stop certain system administrators from reusing passwords, so knowing some of these passwords can usually yield some interesting findings. Another high risk finding is the database credentials, which almost never get changed and often allow system commands to be executed.</p>
<p>Knowing how to find the sensitive information is a great skill to have in your arsenal and I hope this short post inspires you to become a better tester. The days of vulnerability scanners getting you root or system are numbered and exploiting the human weaknesses is becoming a necessity in modern networks.</p>
<p>Keep on sploiting,</p>
<p>norsec0de</p>

            </div>
        </article>

        <hr />

        <div class="post-info">
            
    <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg>

        <span class="tag"><a href="https://www.pwnd.red/tags/hacker-for-hire/">hacker for hire</a></span>
        <span class="tag"><a href="https://www.pwnd.red/tags/kali/">Kali</a></span>
        <span class="tag"><a href="https://www.pwnd.red/tags/passwords/">passwords</a></span>
        <span class="tag"><a href="https://www.pwnd.red/tags/pentesting/">pentesting</a></span>
        <span class="tag"><a href="https://www.pwnd.red/tags/post-exploitation/">post exploitation</a></span>
        <span class="tag"><a href="https://www.pwnd.red/tags/recoll/">recoll</a></span>
        <span class="tag"><a href="https://www.pwnd.red/tags/shareenum/">ShareEnum</a></span>
        <span class="tag"><a href="https://www.pwnd.red/tags/shares/">shares</a></span>
        <span class="tag"><a href="https://www.pwnd.red/tags/windows/">windows</a></span>
        
    </p>

            
    <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-folder meta-icon"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>

        <span class="tag"><a href="https://www.pwnd.red/categories/post-exploitation/">post exploitation</a></span>
        <span class="tag"><a href="https://www.pwnd.red/categories/tools/">tools</a></span>
        <span class="tag"><a href="https://www.pwnd.red/categories/tutorial/">tutorial</a></span>
        
    </p>

  		</div>
    </main>

            </div>

            
                <footer class="footer">
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2020</span>
            
                <span><a href="https://www.pwnd.red/">norsey</a></span>
            
            <span><a href="https://www.pwnd.red/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></span>
        </div>
    </div>
    <div class="footer__inner">
        <div class="footer__content">
            <span>norsey's hideout</span>
            <span>hugo</span>
          </div>
    </div>
</footer>

            
        </div>

        




<script type="text/javascript" src="https://www.pwnd.red/bundle.min.dc716e9092c9820b77f96da294d0120aeeb189b5bcea9752309ebea27fd53bbe6b13cffb2aca8ecf32525647ceb7001f76091de4199ac5a3caa432c070247f5b.js" integrity="sha512-3HFukJLJggt3&#43;W2ilNASCu6xibW86pdSMJ6&#43;on/VO75rE8/7KsqOzzJSVkfOtwAfdgkd5BmaxaPKpDLAcCR/Ww=="></script>



    </body>
</html>
